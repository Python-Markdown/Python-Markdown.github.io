<!DOCTYPE html>

<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        
        <meta name="author" content="The Python-Markdown Project">
        <link rel="canonical" href="https://Python-Markdown.github.io/extensions/api/">
        <link rel="shortcut icon" href="../../favicon.ico">
        <link rel="search" title="Search" href="../../search.html" />
        <link rel="next" title="Test Tools" href="../../test_tools/" />
        <link rel="prev" title="WikiLinks" href="../wikilinks/" />
        <title>Extension API &#8212; Python-Markdown 3.0 documentation</title>
        <link rel="stylesheet" href="../../static/nature.css" type="text/css" />
        <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script> 
    </head>

    <body>
    <div class="related" role="navigation" aria-label="related navigation">
        <h3>Navigation</h3>
        <ul>
                <li class="right" style="margin-right: 10px">
                    <a href="https://github.com/Python-Markdown/markdown/" title="View this project on GitHub"><img src="../../static/github.png" width=16px style="vertical-align: middle; margin-top: -1px" /></a>
                </li>
            <li class="right" style="margin-right: 10px">
                <a href="../../sitemap.html" title="Sitemap" accesskey="I">index</a>
            </li>
            <li class="right">
                <a href="../../test_tools/" title="Test Tools" accesskey="N">next</a> |
            </li>
            <li class="right">
                <a href="../wikilinks/" title="WikiLinks" accesskey="P">previous</a> |
            </li>
            <li><img src="../../py.png"
            alt="icon" style="vertical-align: middle; margin-top: -1px"/></li>
            <li class="nav-item nav-item-0">
                <a href="../..">Python-Markdown 3.0 documentation</a> &#187;
            </li>
                    
                    
                    
                    
                    
                    
                    
        <li class="nav-item">
            <a href="./">Extension API</a>
         &#187; </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
        </ul>
    </div>

        <div class="document">
            <div class="documentwrapper">
                <div class="bodywrapper">
                    <div class="body" role="main"><h1 id="writing-extensions-for-python-markdown">Writing Extensions for Python-Markdown<a class="headerlink" href="#writing-extensions-for-python-markdown" title="Permanent link">&para;</a></h1>
<p>Python-Markdown includes an API for extension writers to plug their own
custom functionality and/or syntax into the parser. There are Preprocessors
which allow you to alter the source before it is passed to the parser,
inline patterns which allow you to add, remove or override the syntax of
any inline elements, and Postprocessors which allow munging of the
output of the parser before it is returned. If you really want to dive in,
there are also Blockprocessors which are part of the core BlockParser.</p>
<p>As the parser builds an <a href="http://effbot.org/zone/element-index.htm">ElementTree</a> object which is later rendered
as Unicode text, there are also some helpers provided to ease manipulation of
the tree. Each part of the API is discussed in its respective section below.
Additionally, reading the source of some <a href="../">Available Extensions</a> may be
helpful. For example, the <a href="https://github.com/Python-Markdown/mdx_footnotes">Footnotes</a> extension uses most of the features
documented here.</p>
<h2 id="preprocessors">Preprocessors<a class="headerlink" href="#preprocessors" title="Permanent link">&para;</a></h2>
<p>Preprocessors munge the source text before it is passed into the Markdown
core. This is an excellent place to clean up bad syntax, extract things the
parser may otherwise choke on and perhaps even store it for later retrieval.</p>
<p>Preprocessors should inherit from <code>markdown.preprocessors.Preprocessor</code> and
implement a <code>run</code> method with one argument <code>lines</code>. The <code>run</code> method of
each Preprocessor will be passed the entire source text as a list of Unicode
strings. Each string will contain one line of text. The <code>run</code> method should
return either that list, or an altered list of Unicode strings.</p>
<p>A pseudo example:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">markdown.preprocessors</span> <span class="kn">import</span> <span class="n">Preprocessor</span>

<span class="k">class</span> <span class="nc">MyPreprocessor</span><span class="p">(</span><span class="n">Preprocessor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="n">new_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">MYREGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="c1"># do stuff</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_lines</span>
</pre></div>


<h2 id="inlinepatterns">Inline Patterns<a class="headerlink" href="#inlinepatterns" title="Permanent link">&para;</a></h2>
<h3 id="legacy">Legacy<a class="headerlink" href="#legacy" title="Permanent link">&para;</a></h3>
<p>Inline Patterns implement the inline HTML element syntax for Markdown such as
<code>*emphasis*</code> or <code>[links](http://example.com)</code>. Pattern objects should be
instances of classes that inherit from <code>markdown.inlinepatterns.Pattern</code> or
one of its children. Each pattern object uses a single regular expression and
must have the following methods:</p>
<ul>
<li>
<p><strong><code>getCompiledRegExp()</code></strong>:</p>
<p>Returns a compiled regular expression.</p>
</li>
<li>
<p><strong><code>handleMatch(m)</code></strong>:</p>
<p>Accepts a match object and returns an ElementTree element of a plain
Unicode string.</p>
</li>
</ul>
<p>Also, Inline Patterns can define the property <code>ANCESTOR_EXCLUDES</code> with either
a list or tuple of undesirable ancestors. The pattern should not match if it
would cause the content to be a descendant of one of the defined tag names.</p>
<p>Note that any regular expression returned by <code>getCompiledRegExp</code> must capture
the whole block. Therefore, they should all start with <code>r'^(.*?)'</code> and end
with <code>r'(.*?)!'</code>. When using the default <code>getCompiledRegExp()</code> method
provided in the <code>Pattern</code> you can pass in a regular expression without that
and <code>getCompiledRegExp</code> will wrap your expression for you and set the
<code>re.DOTALL</code> and <code>re.UNICODE</code> flags. This means that the first group of your
match will be <code>m.group(2)</code> as <code>m.group(1)</code> will match everything before the
pattern.</p>
<p>For an example, consider this simplified emphasis pattern:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">markdown.inlinepatterns</span> <span class="kn">import</span> <span class="n">Pattern</span>
<span class="kn">from</span> <span class="nn">markdown.util</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="k">class</span> <span class="nc">EmphasisPattern</span><span class="p">(</span><span class="n">Pattern</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handleMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;em&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">el</span>
</pre></div>


<p>As discussed in <a href="#integrating_into_markdown">Integrating Your Code Into Markdown</a>, an instance of this
class will need to be provided to Markdown. That instance would be created
like so:</p>
<div class="codehilite"><pre><span></span><span class="c1"># an oversimplified regex</span>
<span class="n">MYPATTERN</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\*([^*]+)\*&#39;</span>
<span class="c1"># pass in pattern and create instance</span>
<span class="n">emphasis</span> <span class="o">=</span> <span class="n">EmphasisPattern</span><span class="p">(</span><span class="n">MYPATTERN</span><span class="p">)</span>
</pre></div>


<p>Actually it would not be necessary to create that pattern (and not just because
a more sophisticated emphasis pattern already exists in Markdown). The fact is,
that example pattern is not very DRY. A pattern for <code>**strong**</code> text would
be almost identical, with the exception that it would create a &lsquo;strong&rsquo; element.
Therefore, Markdown provides a number of generic pattern classes that can
provide some common functionality. For example, both emphasis and strong are
implemented with separate instances of the <code>SimpleTagPattern</code> listed below.
Feel free to use or extend any of the Pattern classes found at
<code>markdown.inlinepatterns</code>.</p>
<h3 id="future">Future<a class="headerlink" href="#future" title="Permanent link">&para;</a></h3>
<p>While users can still create plugins with the existing
<code>markdown.inlinepatterns.Pattern</code>, a new, more flexible inline processor has
been added which users are encouraged to migrate to. The new inline processor
is found at <code>markdown.inlinepatterns.InlineProcessor</code>.</p>
<p>The new processor is very similar to legacy with two major distinctions.</p>
<ol>
<li>
<p>Patterns no longer need to match the entire block, so patterns no longer
    start with <code>r'^(.*?)'</code> and end with <code>r'(.*?)!'</code>. This was a huge
    performance sink and this requirement has been removed. The returned match
    object will only contain what is explicitly matched in the pattern, and
    extension pattern groups now start with <code>m.group(1)</code>.</p>
</li>
<li>
<p>The <code>handleMatch</code> method now takes an additional input called <code>data</code>,
    which is the entire block under analysis, not just what is matched with
    the specified pattern. The method also returns the element <em>and</em> the index
    boundaries relative to <code>data</code> that the return element is replacing
    (usually <code>m.start(0)</code> and <code>m.end(0)</code>).  If the boundaries are returned as
    <code>None</code>, it is assumed that the match did not take place, and nothing will
    be altered in <code>data</code>.</p>
</li>
</ol>
<p>If all you need is the same functionality as the legacy processor, you can do
as shown below. Most of the time, simple regular expression processing is all
you&rsquo;ll need.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">markdown.inlinepatterns</span> <span class="kn">import</span> <span class="n">InlineProcessor</span>
<span class="kn">from</span> <span class="nn">markdown.util</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="c1"># an oversimplified regex</span>
<span class="n">MYPATTERN</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\*([^*]+)\*&#39;</span>

<span class="k">class</span> <span class="nc">EmphasisPattern</span><span class="p">(</span><span class="n">InlineProcessor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handleMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;em&#39;</span><span class="p">)</span>
        <span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">el</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># pass in pattern and create instance</span>
<span class="n">emphasis</span> <span class="o">=</span> <span class="n">EmphasisPattern</span><span class="p">(</span><span class="n">MYPATTERN</span><span class="p">)</span>
</pre></div>


<p>But, the new processor allows you handle much more complex patterns that are
too much for Python&rsquo;s Re to handle.  For instance, to handle nested brackets in
link patterns, the built-in link inline processor uses the following pattern to
find where a link <em>might</em> start:</p>
<div class="codehilite"><pre><span></span><span class="n">LINK_RE</span> <span class="o">=</span> <span class="n">NOIMG</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\[&#39;</span>
<span class="n">link</span> <span class="o">=</span> <span class="n">LinkInlineProcessor</span><span class="p">(</span><span class="n">LINK_RE</span><span class="p">,</span> <span class="n">md_instance</span><span class="p">)</span>
</pre></div>


<p>It then uses programmed logic to actually walk the string (<code>data</code>), starting at
where the match started (<code>m.start(0)</code>). If for whatever reason, the text
does not appear to be a link, it returns <code>None</code> for the start and end boundary
in order to communicate to the parser that no match was found.</p>
<div class="codehilite"><pre><span></span>    <span class="c1"># Just a snippet of the link&#39;s handleMatch</span>
    <span class="c1"># method to illustrate new logic</span>
    <span class="k">def</span> <span class="nf">handleMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">handled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">handled</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

        <span class="n">href</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">handled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLink</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">handled</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

        <span class="n">el</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>

        <span class="n">el</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span> <span class="n">href</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">el</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">el</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">index</span>
</pre></div>


<h3 id="generic-pattern-classes">Generic Pattern Classes<a class="headerlink" href="#generic-pattern-classes" title="Permanent link">&para;</a></h3>
<p>Some example processors that are available.</p>
<ul>
<li>
<p><strong><code>SimpleTextInlineProcessor(pattern)</code></strong>:</p>
<p>Returns simple text of <code>group(2)</code> of a <code>pattern</code> and the start and end
position of the match.</p>
</li>
<li>
<p><strong><code>SimpleTagInlineProcessor(pattern, tag)</code></strong>:</p>
<p>Returns an element of type &ldquo;<code>tag</code>&rdquo; with a text attribute of <code>group(3)</code>
of a <code>pattern</code>. <code>tag</code> should be a string of a HTML element (i.e.: &lsquo;em&rsquo;).
It also returns the start and end position of the match.</p>
</li>
<li>
<p><strong><code>SubstituteTagInlineProcessor(pattern, tag)</code></strong>:</p>
<p>Returns an element of type &ldquo;<code>tag</code>&rdquo; with no children or text (i.e.: <code>br</code>)
and the start and end position of the match.</p>
</li>
</ul>
<p>A very small number of the basic legacy processors are still available to
prevent breakage of 3rd party extensions during the transition period to the
new processors. Three of the available processors are listed below.</p>
<ul>
<li>
<p><strong><code>SimpleTextPattern(pattern)</code></strong>:</p>
<p>Returns simple text of <code>group(2)</code> of a <code>pattern</code>.</p>
</li>
<li>
<p><strong><code>SimpleTagPattern(pattern, tag)</code></strong>:</p>
<p>Returns an element of type &ldquo;<code>tag</code>&rdquo; with a text attribute of <code>group(3)</code>
of a <code>pattern</code>. <code>tag</code> should be a string of a HTML element (i.e.: &lsquo;em&rsquo;).</p>
</li>
<li>
<p><strong><code>SubstituteTagPattern(pattern, tag)</code></strong>:</p>
<p>Returns an element of type &ldquo;<code>tag</code>&rdquo; with no children or text (i.e.: <code>br</code>).</p>
</li>
</ul>
<p>There may be other Pattern classes in the Markdown source that you could extend
or use as well. Read through the source and see if there is anything you can
use. You might even get a few ideas for different approaches to your specific
situation.</p>
<h2 id="treeprocessors">Treeprocessors<a class="headerlink" href="#treeprocessors" title="Permanent link">&para;</a></h2>
<p>Treeprocessors manipulate an ElementTree object after it has passed through the
core BlockParser. This is where additional manipulation of the tree takes
place. Additionally, the InlineProcessor is a Treeprocessor which steps through
the tree and runs the Inline Patterns on the text of each Element in the tree.</p>
<p>A Treeprocessor should inherit from <code>markdown.treeprocessors.Treeprocessor</code>,
over-ride the <code>run</code> method which takes one argument <code>root</code> (an ElementTree
object) and either modifies that root element and returns <code>None</code> or returns a
new ElementTree object.</p>
<p>A pseudo example:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">markdown.treeprocessors</span> <span class="kn">import</span> <span class="n">Treeprocessor</span>

<span class="k">class</span> <span class="nc">MyTreeprocessor</span><span class="p">(</span><span class="n">Treeprocessor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="n">root</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;modified content&#39;</span>
</pre></div>


<p>Note that Python class methods return <code>None</code> by default when no <code>return</code>
statement is defined.  Additionally all Python variables refer to objects by
reference.  Therefore, the above <code>run</code> method modifies the <code>root</code> element
in place and returns <code>None</code>. The changes made to the <code>root</code> element and its
children are retained.</p>
<p>Some may be inclined to return the modified <code>root</code> element. While that would
work, it would cause a copy of the entire ElementTree to be generated each
time the Treeprocessor is run. Therefore, it is generally expected that
the <code>run</code> method would only return <code>None</code> or a new ElementTree object.</p>
<p>For specifics on manipulating the ElementTree, see
<a href="#working_with_et">Working with the ElementTree</a> below.</p>
<h2 id="postprocessors">Postprocessors<a class="headerlink" href="#postprocessors" title="Permanent link">&para;</a></h2>
<p>Postprocessors manipulate the document after the ElementTree has been
serialized into a string. Postprocessors should be used to work with the
text just before output.</p>
<p>A Postprocessor should inherit from <code>markdown.postprocessors.Postprocessor</code>
and over-ride the <code>run</code> method which takes one argument <code>text</code> and returns
a Unicode string.</p>
<p>Postprocessors are run after the ElementTree has been serialized back into
Unicode text.  For example, this may be an appropriate place to add a table of
contents to a document:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">markdown.postprocessors</span> <span class="kn">import</span> <span class="n">Postprocessor</span>

<span class="k">class</span> <span class="nc">TocPostprocessor</span><span class="p">(</span><span class="n">Postprocessor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MYMARKERRE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">MyToc</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</pre></div>


<h2 id="blockparser">BlockParser<a class="headerlink" href="#blockparser" title="Permanent link">&para;</a></h2>
<p>Sometimes, Preprocessors, Treeprocessors, Postprocessors, and Inline Patterns
are not going to do what you need. Perhaps you want a new type of block type
that needs to be integrated into the core parsing. In such a situation, you can
add/change/remove functionality of the core <code>BlockParser</code>. The BlockParser is
composed of a number of Blockprocessors. The BlockParser steps through each
block of text (split by blank lines) and passes each block to the appropriate
Blockprocessor. That Blockprocessor parses the block and adds it to the
ElementTree. The
<a href="https://github.com/Python-Markdown/mdx_definition_lists">Definition Lists</a> extension would be a good example of an extension that
adds/modifies Blockprocessors.</p>
<p>A Blockprocessor should inherit from <code>markdown.blockprocessors.BlockProcessor</code>
and implement both the <code>test</code> and <code>run</code> methods.</p>
<p>The <code>test</code> method is used by BlockParser to identify the type of block.
Therefore the <code>test</code> method must return a Boolean value. If the test returns
<code>True</code>, then the BlockParser will call that Blockprocessor&rsquo;s <code>run</code> method.
If it returns <code>False</code>, the BlockParser will move on to the next
Blockprocessor.</p>
<p>The <strong><code>test</code></strong> method takes two arguments:</p>
<ul>
<li>
<p><strong><code>parent</code></strong>: The parent ElementTree Element of the block. This can be useful
  as the block may need to be treated differently if it is inside a list, for
  example.</p>
</li>
<li>
<p><strong><code>block</code></strong>: A string of the current block of text. The test may be a
  simple string method (such as <code>block.startswith(some_text)</code>) or a complex
  regular expression.</p>
</li>
</ul>
<p>The <strong><code>run</code></strong> method takes two arguments:</p>
<ul>
<li>
<p><strong><code>parent</code></strong>: A pointer to the parent ElementTree Element of the block. The run
  method will most likely attach additional nodes to this parent. Note that
  nothing is returned by the method. The ElementTree object is altered in place.</p>
</li>
<li>
<p><strong><code>blocks</code></strong>: A list of all remaining blocks of the document. Your run
  method must remove (pop) the first block from the list (which it altered in
  place - not returned) and parse that block. You may find that a block of text
  legitimately contains multiple block types. Therefore, after processing the
  first type, your processor can insert the remaining text into the beginning
  of the <code>blocks</code> list for future parsing.</p>
</li>
</ul>
<p>Please be aware that a single block can span multiple text blocks. For example,
The official Markdown syntax rules state that a blank line does not end a
Code Block. If the next block of text is also indented, then it is part of
the previous block. Therefore, the BlockParser was specifically designed to
address these types of situations. If you notice the <code>CodeBlockProcessor</code>,
in the core, you will note that it checks the last child of the <code>parent</code>.
If the last child is a code block (<code>&lt;pre&gt;&lt;code&gt;...&lt;/code&gt;&lt;/pre&gt;</code>), then it
appends that block to the previous code block rather than creating a new
code block.</p>
<p>Each Blockprocessor has the following utility methods available:</p>
<ul>
<li>
<p><strong><code>lastChild(parent)</code></strong>:</p>
<p>Returns the last child of the given ElementTree Element or <code>None</code> if it
had no children.</p>
</li>
<li>
<p><strong><code>detab(text)</code></strong>:</p>
<p>Removes one level of indent (four spaces by default) from the front of each
line of the given text string.</p>
</li>
<li>
<p><strong><code>looseDetab(text, level)</code></strong>:</p>
<p>Removes &ldquo;level&rdquo; levels of indent (defaults to 1) from the front of each line
of the given text string. However, this methods allows secondary lines to
not be indented as does some parts of the Markdown syntax.</p>
</li>
</ul>
<p>Each Blockprocessor also has a pointer to the containing BlockParser instance at
<code>self.parser</code>, which can be used to check or alter the state of the parser.
The BlockParser tracks it&rsquo;s state in a stack at <code>parser.state</code>. The state
stack is an instance of the <code>State</code> class.</p>
<p><strong><code>State</code></strong> is a subclass of <code>list</code> and has the additional methods:</p>
<ul>
<li>
<p><strong><code>set(state)</code></strong>:</p>
<p>Set a new state to string <code>state</code>. The new state is appended to the end
of the stack.</p>
</li>
<li>
<p><strong><code>reset()</code></strong>:</p>
<p>Step back one step in the stack. The last state at the end is removed from
the stack.</p>
</li>
<li>
<p><strong><code>isstate(state)</code></strong>:</p>
<p>Test that the top (current) level of the stack is of the given string
<code>state</code>.</p>
</li>
</ul>
<p>Note that to ensure that the state stack does not become corrupted, each time a
state is set for a block, that state <em>must</em> be reset when the parser finishes
parsing that block.</p>
<p>An instance of the <strong><code>BlockParser</code></strong> is found at <code>Markdown.parser</code>.
<code>BlockParser</code> has the following methods:</p>
<ul>
<li>
<p><strong><code>parseDocument(lines)</code></strong>:</p>
<p>Given a list of lines, an ElementTree object is returned. This should be
passed an entire document and is the only method the <code>Markdown</code> class
calls directly.</p>
</li>
<li>
<p><strong><code>parseChunk(parent, text)</code></strong>:</p>
<p>Parses a chunk of markdown text composed of multiple blocks and attaches
those blocks to the <code>parent</code> Element. The <code>parent</code> is altered in place
and nothing is returned. Extensions would most likely use this method for
block parsing.</p>
</li>
<li>
<p><strong><code>parseBlocks(parent, blocks)</code></strong>:</p>
<p>Parses a list of blocks of text and attaches those blocks to the <code>parent</code>
Element. The <code>parent</code> is altered in place and nothing is returned. This
method will generally only be used internally to recursively parse nested
blocks of text.</p>
</li>
</ul>
<p>While it is not recommended, an extension could subclass or completely replace
the <code>BlockParser</code>. The new class would have to provide the same public API.
However, be aware that other extensions may expect the core parser provided
and will not work with such a drastically different parser.</p>
<h2 id="working_with_et">Working with the ElementTree<a class="headerlink" href="#working_with_et" title="Permanent link">&para;</a></h2>
<p>As mentioned, the Markdown parser converts a source document to an
<a href="http://effbot.org/zone/element-index.htm">ElementTree</a> object before serializing that back to Unicode text.
Markdown has provided some helpers to ease that manipulation within the context
of the Markdown module.</p>
<p>First, to get access to the ElementTree module import ElementTree from
<code>markdown</code> rather than importing it directly. This will ensure you are using
the same version of ElementTree as markdown. The module is found at
<code>markdown.util.etree</code> within Markdown.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">markdown.util</span> <span class="kn">import</span> <span class="n">etree</span>
</pre></div>


<p><code>markdown.util.etree</code> tries to import ElementTree from any known location,
first as a standard library module (from <code>xml.etree</code> in Python 2.5), then as
a third party package (ElementTree). In each instance, <code>cElementTree</code> is
tried first, then ElementTree if the faster C implementation is not
available on your system.</p>
<p>Sometimes you may want text inserted into an element to be parsed by
<a href="#inlinepatterns">Inline Patterns</a>. In such a situation, simply insert the text as you normally
would and the text will be automatically run through the Inline Patterns.
However, if you do <em>not</em> want some text to be parsed by Inline Patterns,
then insert the text as an <code>AtomicString</code>.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">markdown.util</span> <span class="kn">import</span> <span class="n">AtomicString</span>
<span class="n">some_element</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">AtomicString</span><span class="p">(</span><span class="n">some_text</span><span class="p">)</span>
</pre></div>


<p>Here&rsquo;s a basic example which creates an HTML table (note that the contents of
the second cell (<code>td2</code>) will be run through Inline Patterns latter):</p>
<div class="codehilite"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cellpadding&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>                      <span class="c1"># Set cellpadding to 2</span>
<span class="n">tr</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s2">&quot;tr&quot;</span><span class="p">)</span>                 <span class="c1"># Add child tr to table</span>
<span class="n">td1</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="s2">&quot;td&quot;</span><span class="p">)</span>                   <span class="c1"># Add child td1 to tr</span>
<span class="n">td1</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">AtomicString</span><span class="p">(</span><span class="s2">&quot;Cell content&quot;</span><span class="p">)</span> <span class="c1"># Add plain text content</span>
<span class="n">td2</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="s2">&quot;td&quot;</span><span class="p">)</span>                   <span class="c1"># Add second td to tr</span>
<span class="n">td2</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;*text* with **inline** formatting.&quot;</span>    <span class="c1"># Add markup text</span>
<span class="n">table</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="s2">&quot;Text after table&quot;</span>                    <span class="c1"># Add text after table</span>
</pre></div>


<p>You can also manipulate an existing tree. Consider the following example which
adds a <code>class</code> attribute to <code>&lt;a&gt;</code> elements:</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_link_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
              <span class="n">child</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;myclass&quot;</span><span class="p">)</span> <span class="c1">#set the class attribute</span>
          <span class="n">set_link_class</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="c1"># run recursively on children</span>
</pre></div>


<p>For more information about working with ElementTree see the ElementTree
<a href="http://effbot.org/zone/element-index.htm">Documentation</a>
(<a href="http://docs.python.org/lib/module-xml.etree.ElementTree.html">Python Docs</a>).</p>
<h2 id="integrating_into_markdown">Integrating Your Code Into Markdown<a class="headerlink" href="#integrating_into_markdown" title="Permanent link">&para;</a></h2>
<p>Once you have the various pieces of your extension built, you need to tell
Markdown about them and ensure that they are run in the proper sequence.
Markdown accepts an <code>Extension</code> instance for each extension. Therefore, you
will need to define a class that extends <code>markdown.extensions.Extension</code> and
over-rides the <code>extendMarkdown</code> method. Within this class you will manage
configuration options for your extension and attach the various processors and
patterns to the Markdown instance.</p>
<p>It is important to note that the order of the various processors and patterns
matters. For example, if we replace <code>http://...</code> links with <code>&lt;a&gt;</code> elements, and
<em>then</em> try to deal with  inline HTML, we will end up with a mess. Therefore, the
various types of processors and patterns are stored within an instance of the
Markdown class in a <a href="#registry">Registry</a>. Your <code>Extension</code> class will need to manipulate
those registries appropriately. You may <code>register</code> instances of your processors
and patterns with an appropriate priority, <code>deregister</code> built-in instances, or
replace a built-in instance with your own.</p>
<h3 id="extendmarkdown"><code>extendMarkdown</code><a class="headerlink" href="#extendmarkdown" title="Permanent link">&para;</a></h3>
<p>The <code>extendMarkdown</code> method of a <code>markdown.extensions.Extension</code> class
accepts one argument:</p>
<ul>
<li>
<p><strong><code>md</code></strong>:</p>
<p>A pointer to the instance of the Markdown class. You should use this to
access the <a href="#registry">Registries</a> of processors and patterns. They are
found under the following attributes:</p>
<ul>
<li><code>md.preprocessors</code></li>
<li><code>md.inlinePatterns</code></li>
<li><code>md.parser.blockprocessors</code></li>
<li><code>md.treeprocessors</code></li>
<li><code>md.postprocessors</code></li>
</ul>
<p>Some other things you may want to access in the markdown instance are:</p>
<ul>
<li><code>md.htmlStash</code></li>
<li><code>md.output_formats</code></li>
<li><code>md.set_output_format()</code></li>
<li><code>md.output_format</code></li>
<li><code>md.serializer</code></li>
<li><code>md.registerExtension()</code></li>
<li><code>md.tab_length</code></li>
<li><code>md.block_level_elements</code></li>
<li><code>md.isBlockLevel()</code></li>
</ul>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>With access to the above items, theoretically you have the option to
change anything through various <a href="http://en.wikipedia.org/wiki/Monkey_patch">monkey_patching</a> techniques. However,
you should be aware that the various undocumented parts of markdown may
change without notice and your monkey_patches may break with a new release.
Therefore, what you really should be doing is inserting processors and
patterns into the markdown pipeline. Consider yourself warned!</p>
</div>
<p>A simple example:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">markdown.extensions</span> <span class="kn">import</span> <span class="n">Extension</span>

<span class="k">class</span> <span class="nc">MyExtension</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">extendMarkdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">md</span><span class="p">):</span>
        <span class="c1"># Register instance of &#39;mypattern&#39; with a priority of 175</span>
        <span class="n">md</span><span class="o">.</span><span class="n">inlinePatterns</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyPattern</span><span class="p">(</span><span class="n">md</span><span class="p">),</span> <span class="s1">&#39;mypattern&#39;</span><span class="p">,</span> <span class="mi">175</span><span class="p">)</span>
</pre></div>


<h3 id="registry">Registry<a class="headerlink" href="#registry" title="Permanent link">&para;</a></h3>
<p>The <code>markdown.util.Registry</code> class is a priority sorted registry which Markdown
uses internally to determine the processing order of its various processors and
patterns.</p>
<p>A <code>Registry</code> instance provides two public methods to alter the data of the
registry: <code>register</code> and <code>deregister</code>. Use <code>register</code> to add items and
<code>deregister</code> to remove items. See each method for specifics.</p>
<p>When registering an item, a &ldquo;name&rdquo; and a &ldquo;priority&rdquo; must be provided. All
items are automatically sorted by &ldquo;priority&rdquo; from highest to lowest. The
&ldquo;name&rdquo; is used to remove (<code>deregister</code>) and get items.</p>
<p>A <code>Registry</code> instance is like a list (which maintains order) when reading
data. You may iterate over the items, get an item and get a count (length)
of all items. You may also check that the registry contains an item.</p>
<p>When getting an item you may use either the index of the item or the
string-based &ldquo;name&rdquo;. For example:</p>
<div class="codehilite"><pre><span></span>registry = Registry()
registry.register(SomeItem(), &#39;itemname&#39;, 20)
# Get the item by index
item = registry[0]
# Get the item by name
item = registry[&#39;itemname&#39;]
</pre></div>


<p>When checking that the registry contains an item, you may use either the
string-based &ldquo;name&rdquo;, or a reference to the actual item. For example:</p>
<div class="codehilite"><pre><span></span>someitem = SomeItem()
registry.register(someitem, &#39;itemname&#39;, 20)
# Contains the name
assert &#39;itemname&#39; in registry
# Contains the item instance
assert someitem in registry
</pre></div>


<p><code>markdown.util.Registry</code> has the following methods:</p>
<h4 id="registry.register"><code>Registry.register(self, item, name, priority)</code><a class="headerlink" href="#registry.register" title="Permanent link">&para;</a></h4>
<dl>
<dd>
<p>Add an item to the registry with the given name and priority.</p>
<p>Parameters:</p>
<ul>
<li><code>item</code>: The item being registered.</li>
<li><code>name</code>: A string used to reference the item.</li>
<li><code>priority</code>: An integer or float used to sort against all items.</li>
</ul>
<p>If an item is registered with a &ldquo;name&rdquo; which already exists, the existing
item is replaced with the new item. Tread carefully as the old item is lost
with no way to recover it. The new item will be sorted according to its
priority and will <strong>not</strong> retain the position of the old item.</p>
</dd>
</dl>
<h4 id="registry.deregister"><code>Registry.deregister(self, name, strict=True)</code><a class="headerlink" href="#registry.deregister" title="Permanent link">&para;</a></h4>
<dl>
<dd>
<p>Remove an item from the registry.</p>
<p>Set <code>strict=False</code> to fail silently.</p>
</dd>
</dl>
<h4 id="registry.get_index_for_name"><code>Registry.get_index_for_name(self, name)</code><a class="headerlink" href="#registry.get_index_for_name" title="Permanent link">&para;</a></h4>
<dl>
<dd>Return the index of the given <code>name</code>.</dd>
</dl>
<h3 id="registerextension">registerExtension<a class="headerlink" href="#registerextension" title="Permanent link">&para;</a></h3>
<p>Some extensions may need to have their state reset between multiple runs of the
Markdown class. For example, consider the following use of the <a href="https://github.com/Python-Markdown/mdx_footnotes">Footnotes</a>
extension:</p>
<div class="codehilite"><pre><span></span><span class="n">md</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;footnotes&#39;</span><span class="p">])</span>
<span class="n">html1</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">text_with_footnote</span><span class="p">)</span>
<span class="n">md</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">html2</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">text_without_footnote</span><span class="p">)</span>
</pre></div>


<p>Without calling <code>reset</code>, the footnote definitions from the first document will
be inserted into the second document as they are still stored within the class
instance. Therefore the <code>Extension</code> class needs to define a <code>reset</code> method
that will reset the state of the extension (i.e.: <code>self.footnotes = {}</code>).
However, as many extensions do not have a need for <code>reset</code>, <code>reset</code> is only
called on extensions that are registered.</p>
<p>To register an extension, call <code>md.registerExtension</code> from within your
<code>extendMarkdown</code> method:</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extendMarkdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">md</span><span class="p">):</span>
    <span class="n">md</span><span class="o">.</span><span class="n">registerExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c1"># insert processors and patterns here</span>
</pre></div>


<p>Then, each time <code>reset</code> is called on the Markdown instance, the <code>reset</code>
method of each registered extension will be called as well. You should also
note that <code>reset</code> will be called on each registered extension after it is
initialized the first time. Keep that in mind when over-riding the extension&rsquo;s
<code>reset</code> method.</p>
<h3 id="configsettings">Configuration Settings<a class="headerlink" href="#configsettings" title="Permanent link">&para;</a></h3>
<p>If an extension uses any parameters that the user may want to change,
those parameters should be stored in <code>self.config</code> of your
<code>markdown.extensions.Extension</code> class in the following format:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyExtension</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">Extension</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;option1&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="s1">&#39;description1&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;option2&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;value2&#39;</span><span class="p">,</span> <span class="s1">&#39;description2&#39;</span><span class="p">]</span> <span class="p">}</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyExtension</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>


<p>When implemented this way the configuration parameters can be over-ridden at
run time (thus the call to <code>super</code>). For example:</p>
<div class="codehilite"><pre><span></span><span class="n">markdown</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="n">MyExtension</span><span class="p">(</span><span class="n">option1</span><span class="o">=</span><span class="s1">&#39;other value&#39;</span><span class="p">])</span>
</pre></div>


<p>Note that if a keyword is passed in that is not already defined in
<code>self.config</code>, then a <code>KeyError</code> is raised.</p>
<p>The <code>markdown.extensions.Extension</code> class and its subclasses have the
following methods available to assist in working with configuration settings:</p>
<ul>
<li>
<p><strong><code>getConfig(key [, default])</code></strong>:</p>
<p>Returns the stored value for the given <code>key</code> or <code>default</code> if the <code>key</code>
does not exist. If not set, <code>default</code> returns an empty string.</p>
</li>
<li>
<p><strong><code>getConfigs()</code></strong>:</p>
<p>Returns a dict of all key/value pairs.</p>
</li>
<li>
<p><strong><code>getConfigInfo()</code></strong>:</p>
<p>Returns all configuration descriptions as a list of tuples.</p>
</li>
<li>
<p><strong><code>setConfig(key, value)</code></strong>:</p>
<p>Sets a configuration setting for <code>key</code> with the given <code>value</code>. If <code>key</code> is
unknown, a <code>KeyError</code> is raised. If the previous value of <code>key</code> was
a Boolean value, then <code>value</code> is converted to a Boolean value. If
the previous value of <code>key</code> is <code>None</code>, then <code>value</code> is converted to
a Boolean value except when it is <code>None</code>. No conversion takes place
when the previous value of <code>key</code> is a string.</p>
</li>
<li>
<p><strong><code>setConfigs(items)</code></strong>:</p>
<p>Sets multiple configuration settings given a dict of key/value pairs.</p>
</li>
</ul>
<h3 id="naming_an_extension">Naming an Extension<a class="headerlink" href="#naming_an_extension" title="Permanent link">&para;</a></h3>
<p>As noted in the <a href="../../reference/">library reference</a> an instance of an extension can be passed
directly to Markdown. In fact, this is the preferred way to use third-party
extensions.</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">markdown</span>
<span class="kn">from</span> <span class="nn">path.to.module</span> <span class="kn">import</span> <span class="n">MyExtension</span>
<span class="n">md</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">Markdown</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="n">MyExtension</span><span class="p">(</span><span class="n">option</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)])</span>
</pre></div>


<p>However, Markdown also accepts &ldquo;named&rdquo; third party extensions for those
occasions when it is impractical to import an extension directly (from the
command line or from within templates). A &ldquo;name&rdquo; can either be a registered
<a href="#entry_point">entry point</a> or a string using Python&rsquo;s <a href="#dot_notation">dot
notation</a>.</p>
<h4 id="entry_point">Entry Point<a class="headerlink" href="#entry_point" title="Permanent link">&para;</a></h4>
<p><a href="https://setuptools.readthedocs.io/en/latest/setuptools.html#dynamic-discovery-of-services-and-plugins">Entry points</a> are defined in a Python package&rsquo;s <code>setup.py</code> script. The script
must use <a href="https://packaging.python.org/key_projects/#setuptools">setuptools</a> to support entry points. Python-Markdown extensions must
be assigned to the <code>markdown.extensions</code> group. An entry point definition might
look like this:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="c1"># ...</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;markdown.extensions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;myextension = path.to.module:MyExtension&#39;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>


<p>After a user installs your extension using the above script, they could then
call the extension using the <code>myextension</code> string name like this:</p>
<div class="codehilite"><pre><span></span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;myextension&#39;</span><span class="p">])</span>
</pre></div>


<p>Note that if two or more entry points within the same group are assigned the
same name, Python-Markdown will only ever use the first one found and ignore all
others. Therefore, be sure to give your extension a unique name.</p>
<p>For more information on writing <code>setup.py</code> scripts, see the Python documentation
on <a href="https://packaging.python.org/tutorials/distributing-packages/">Packaging and Distributing Projects</a>.</p>
<h4 id="dot_notation">Dot Notation<a class="headerlink" href="#dot_notation" title="Permanent link">&para;</a></h4>
<p>If an extension does not have a registered entry point, Python&rsquo;s dot notation
may be used instead. The extension must be installed as a Python module on your
PYTHONPATH. Generally, a class should be specified in the name. The class must
be at the end of the name and be separated by a colon from the module.</p>
<p>Therefore, if you were to import the class like this:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">path.to.module</span> <span class="kn">import</span> <span class="n">MyExtension</span>
</pre></div>


<p>Then the extension can be loaded as follows:</p>
<div class="codehilite"><pre><span></span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;path.to.module:MyExtension&#39;</span><span class="p">])</span>
</pre></div>


<p>You do not need to do anything special to support this feature. As long as your
extension class is able to be imported, a user can include it with the above
syntax.</p>
<p>The above two methods are especially useful if you need to implement a large
number of extensions with more than one residing in a module. However, if you do
not want to require that your users include the class name in their string, you
must define only one extension per module and that module must contain a
module-level function called <code>makeExtension</code> that accepts <code>**kwargs</code> and returns
an extension instance.</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyExtension</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">Extension</span><span class="p">)</span>
    <span class="c1"># Define extension here...</span>

<span class="k">def</span> <span class="nf">makeExtension</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">MyExtension</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>


<p>When Markdown is passed the &ldquo;name&rdquo; of your extension as a dot notation string
that does not include a class (for example <code>path.to.module</code>), it will import the
module and call the <code>makeExtension</code> function to initiate your extension.</p>

                    </div>
                </div>
            </div>
    <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
                
    <li>
        <a class="reference internal" href="#writing-extensions-for-python-markdown">Writing Extensions for Python-Markdown</a>
        <ul>
            
    <li>
        <a class="reference internal" href="#preprocessors">Preprocessors</a>
    </li>
            
    <li>
        <a class="reference internal" href="#inlinepatterns">Inline Patterns</a>
        <ul>
            
    <li>
        <a class="reference internal" href="#legacy">Legacy</a>
    </li>
            
    <li>
        <a class="reference internal" href="#future">Future</a>
    </li>
            
    <li>
        <a class="reference internal" href="#generic-pattern-classes">Generic Pattern Classes</a>
    </li>
        </ul>
    </li>
            
    <li>
        <a class="reference internal" href="#treeprocessors">Treeprocessors</a>
    </li>
            
    <li>
        <a class="reference internal" href="#postprocessors">Postprocessors</a>
    </li>
            
    <li>
        <a class="reference internal" href="#blockparser">BlockParser</a>
    </li>
            
    <li>
        <a class="reference internal" href="#working_with_et">Working with the ElementTree</a>
    </li>
            
    <li>
        <a class="reference internal" href="#integrating_into_markdown">Integrating Your Code Into Markdown</a>
        <ul>
            
    <li>
        <a class="reference internal" href="#extendmarkdown">extendMarkdown</a>
    </li>
            
    <li>
        <a class="reference internal" href="#registry">Registry</a>
        <ul>
            
    <li>
        <a class="reference internal" href="#registry.register">Registry.register(self, item, name, priority)</a>
    </li>
            
    <li>
        <a class="reference internal" href="#registry.deregister">Registry.deregister(self, name, strict=True)</a>
    </li>
            
    <li>
        <a class="reference internal" href="#registry.get_index_for_name">Registry.get_index_for_name(self, name)</a>
    </li>
        </ul>
    </li>
            
    <li>
        <a class="reference internal" href="#registerextension">registerExtension</a>
    </li>
            
    <li>
        <a class="reference internal" href="#configsettings">Configuration Settings</a>
    </li>
            
    <li>
        <a class="reference internal" href="#naming_an_extension">Naming an Extension</a>
        <ul>
            
    <li>
        <a class="reference internal" href="#entry_point">Entry Point</a>
    </li>
            
    <li>
        <a class="reference internal" href="#dot_notation">Dot Notation</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
        </ul>
    </li>
            </ul>
            
            <h4>Previous topic</h4>
            <p class="topless">
                <a href="../wikilinks/" title="previous page">WikiLinks</a>
            </p>

            
            <h4>Next topic</h4>
            <p class="topless">
                <a href="../../test_tools/" title="next page">Test Tools</a>
            </p>

            <div role="note" aria-label="source link">
                <h3>This Page</h3>
                <ul class="this-page-menu">
                    <li><a href="https://github.com/Python-Markdown/markdown/issues">Report a Bug</a></li>
                    <li><a href="https://github.com/Python-Markdown/markdown/edit/master/docs/extensions/api.md">Edit on GitHub</a></li>
                </ul>
            </div>
            <div id="searchbox" style="display: none" role="search">
                <h3>Quick search</h3>
                <form class="search" action="../../search.html" method="get">
                    <div><input type="text" name="q" placeholder="Search docs" /></div>
                    <div><input type="submit" value="Go" /></div>
                </form>
            </div>
            <script type="text/javascript">$('#searchbox').show(0);</script>

        </div>
    </div>

            <div class="clearer"></div>
        </div>
    <div class="related" role="navigation" aria-label="related navigation">
        <h3>Navigation</h3>
        <ul>
                <li class="right" style="margin-right: 10px">
                    <a href="https://github.com/Python-Markdown/markdown/" title="View this project on GitHub"><img src="../../static/github.png" width=16px style="vertical-align: middle; margin-top: -1px" /></a>
                </li>
            <li class="right" style="margin-right: 10px">
                <a href="../../sitemap.html" title="Sitemap" accesskey="I">index</a>
            </li>
            <li class="right">
                <a href="../../test_tools/" title="Test Tools" accesskey="N">next</a> |
            </li>
            <li class="right">
                <a href="../wikilinks/" title="WikiLinks" accesskey="P">previous</a> |
            </li>
            <li><img src="../../py.png"
            alt="icon" style="vertical-align: middle; margin-top: -1px"/></li>
            <li class="nav-item nav-item-0">
                <a href="../..">Python-Markdown 3.0 documentation</a> &#187;
            </li>
                    
                    
                    
                    
                    
                    
                    
        <li class="nav-item">
            <a href="./">Extension API</a>
         &#187; </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
        </ul>
    </div>
        <div class="footer" role="contentinfo">Copyright &copy; 2010-2017, The Python-Markdown Project.
        Created using <a href="https://www.mkdocs.org/">MkDocs</a> 1.0.4.
        </div>
        <script>var base_url = '../..';</script>
        <script src="../../search/main.js"></script>

        <!--
        MkDocs version      : 1.0.4
        Docs Build Date UTC : 2018-09-22 02:11:21
        -->
    </body>
</html>